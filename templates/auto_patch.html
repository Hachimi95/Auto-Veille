{% extends 'base.html' %}
{% block title %}Auto Patch | Auto-Veille{% endblock %}
{% block content %}
<section class="container" style="max-width:600px; margin:0 auto; padding: 2rem; background: var(--card-bg); border-radius: var(--radius); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
  <h2 style="text-align:center; margin-bottom: 1.5rem; color: var(--primary-color);">Automatic Excel Patch Merge</h2>
  <form id="patch-form" method="post" enctype="multipart/form-data" style="display: flex; flex-direction: column; gap: 1rem;">
    <div id="drop-area" style="border: 2px dashed var(--primary-color); border-radius: var(--radius); padding: 2rem; text-align: center; background: #f5f5f5; transition: border-color .2s; cursor: pointer;">
      <span style="font-size: 2.5em;">ðŸ“Š</span>
      <p id="file-name" style="margin-top: 0.5rem; color: #555; font-size:1.08em;">Drag and drop your Excel files here or click to select</p>
      <input type="file" id="excel_file" name="excel_file" accept=".xlsx,.xls" style="display: none;">
    </div>
    <input type="text" name="sheet_name" placeholder="Sheet name (optional)" style="padding:0.8rem; border-radius:var(--radius); border:1px solid #ddd;">
    <button class="btn purple-btn" type="submit">Merge</button>
    <p style="color: #777; font-size:1em; text-align:center;">Only Excel files (.xlsx, .xls) are accepted.</p>
  </form>
  {% if error %}
    <div style="background:#e74c3c; padding:12px 18px; border-radius:var(--radius); color:#fff; margin:18px 0; text-align:center;">{{ error }}</div>
  {% endif %}
  {% if message %}
    <div style="background:var(--secondary-color); padding:12px 18px; border-radius:var(--radius); color:#fff; margin:18px 0; text-align:center;">{{ message }}</div>
  {% endif %}
</section>
{% endblock %}
{% block scripts %}
<style>
  .purple-btn {
    font-size: 1.05em;
    padding: 10px 28px;
    border-radius: 22px;
    background: #764ba2;
    color: #fff;
    font-weight: 700;
    border: none;
    box-shadow: 0 2px 8px rgba(94,93,240,0.08);
    transition: background 0.18s, box-shadow 0.18s, transform 0.12s;
    cursor: pointer;
    letter-spacing: 0.5px;
    margin-top: 0.5em;
    min-width: 120px;
    min-height: 40px;
    display: inline-block;
  }
  .purple-btn:hover, .purple-btn:focus {
    background: #4e1c7e;
    box-shadow: 0 4px 16px rgba(94,93,240,0.16);
    transform: translateY(-2px) scale(1.03);
    color: #fff;
    outline: none;
  }
  #file-name.selected {
    color: #764ba2;
    font-weight: 600;
    font-size: 1.12em;
    margin-top: 1em;
  }
</style>
<script>
const dropArea = document.getElementById('drop-area');
const fileInput = document.getElementById('excel_file');
const fileName = document.getElementById('file-name');

dropArea.addEventListener('click', () => fileInput.click());
dropArea.addEventListener('dragover', e => { 
  e.preventDefault(); 
  dropArea.style.borderColor = 'var(--secondary-color)'; 
});
dropArea.addEventListener('dragleave', e => { 
  e.preventDefault(); 
  dropArea.style.borderColor = 'var(--primary-color)'; 
});
dropArea.addEventListener('drop', e => {
  e.preventDefault();
  dropArea.style.borderColor = 'var(--primary-color)';
  fileInput.files = e.dataTransfer.files;
  if (fileInput.files.length > 0) {
    fileName.textContent = `File selected: ${fileInput.files[0].name}`;
    fileName.classList.add('selected');
  } else {
    fileName.textContent = 'Drag and drop your Excel files here or click to select';
    fileName.classList.remove('selected');
  }
});
fileInput.addEventListener('change', function() {
  if (fileInput.files.length > 0) {
    fileName.textContent = `File selected: ${fileInput.files[0].name}`;
    fileName.classList.add('selected');
  } else {
    fileName.textContent = 'Drag and drop your Excel files here or click to select';
    fileName.classList.remove('selected');
  }
});
document.getElementById('patch-form').addEventListener('submit', function(e) {
  if (!fileInput.files.length) {
    showToast('Please select an Excel file.', 'error');
    e.preventDefault();
  }
});
</script>
{% endblock %}